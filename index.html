<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë®¤ì§ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ (JSON ìˆœì°¨ ì¬ìƒ)</title>
  <style>
    :root { --pink:#f472b6; --pink-50:#fdf2f8; --pink-100:#fce7f3; --gray:#334155; --line:#e5e7eb; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Apple SD Gothic Neo,Pretendard,system-ui,sans-serif; color:var(--gray); background:var(--pink-50); }
    .wrap{ max-width:420px; margin:0 auto; min-height:100vh; display:flex; flex-direction:column; }
    header{ position:sticky; top:0; z-index:10; backdrop-filter: blur(6px); background:rgba(252, 231, 243, .9); border-bottom:1px solid var(--line); padding:12px 16px; display:flex; align-items:center; justify-content:space-between; }
    header .title{ font-weight:800; }
    main{ flex:1; padding:0 12px 100px; }
    .card{ margin-top:12px; background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:0 4px 14px rgba(0,0,0,.06); overflow:hidden; }
    .now{ display:grid; grid-template-columns:56px 1fr; gap:12px; align-items:center; padding:14px; }
    .badge{ height:56px; width:56px; border-radius:14px; background:var(--pink-100); color:#be185d; font-weight:800; display:grid; place-items:center; }
    .controls{ margin-top:8px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .btn{ border:1px solid var(--line); background:#fff; border-radius:16px; padding:8px 12px; font-size:14px; }
    .btn-round{ height:48px; width:48px; border-radius:999px; display:grid; place-items:center; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    .btn-primary{ background:var(--pink); color:#fff; border-color:var(--pink); }
    .playlist{ margin-top:12px; }
    .row{ display:flex; gap:12px; align-items:center; width:100%; background:#fff; border:1px solid var(--line); border-radius:16px; padding:12px; margin-bottom:8px; }
    .row.active{ border-color:#be185d; background:#fff0f7; }
    .row .rank{ height:40px; width:40px; border-radius:10px; background:var(--pink-100); color:#be185d; font-weight:800; display:grid; place-items:center; font-size:13px; }
    .row .meta{ flex:1; min-width:0; }
    .row .artist{ font-size:14px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .row .title{ font-size:12px; color:#64748b; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    footer{ position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid var(--line); padding:6px 12px; font-size:11px; color:#64748b; display:flex; justify-content:space-between; }
    .hint{ margin-top:8px; font-size:12px; color:#64748b; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">ë®¤ì§ë¹„ë””ì˜¤ ì±„ë„</div>
      <div style="font-size:12px;color:#64748b">JSON ì¬ìƒ ë¦¬ìŠ¤íŠ¸</div>
    </header>

    <main>
      <div class="card">
        <div id="player" style="aspect-ratio:16/9;background:#000"></div>
      </div>

      <div class="card now">
        <div class="badge" id="badge">-</div>
        <div>
          <div style="font-size:12px;color:#64748b">NOW PLAYING</div>
          <div id="now" style="font-size:16px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"></div>
        </div>
      </div>

      <div class="controls">
        <button id="loopBtn" class="btn">ë°˜ë³µ</button>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevBtn" class="btn btn-round">â®ï¸</button>
          <button id="playBtn" class="btn btn-round btn-primary">â–¶ï¸</button>
          <button id="nextBtn" class="btn btn-round">â­ï¸</button>
        </div>
        <button id="muteBtn" class="btn">ğŸ”‡</button>
      </div>

      <div class="playlist" id="list"></div>
      <div class="hint" id="hint"></div>
    </main>

    <footer>
      <span>Â© </span>
      <span>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìë™ì¬ìƒ Â· ëª¨ë°”ì¼ ìµœì í™”</span>
    </footer>
  </div>

  <script>
    // === ì„¤ì • ===
    const FALLBACK = [
      { rank: 1, artist: "BABYMONSTER", title: "DRIP", url: "https://www.youtube.com/watch?v=Zp-Jhuhq0bQ" },
      { rank: 2, artist: "aespa", title: "Whiplash", url: "https://www.youtube.com/watch?v=jWQx2f-CErU" },
      { rank: 3, artist: "Stray Kids", title: "Chk Chk Boom", url: "https://www.youtube.com/watch?v=0P0aQreFs8w" },
      { rank: 4, artist: "LE SSERAFIM", title: "EASY", url: "https://www.youtube.com/watch?v=bNKXxwOQYB8" },
      { rank: 5, artist: "NewJeans", title: "How Sweet", url: "https://www.youtube.com/watch?v=Q3K0TOvTOno" },
      { rank: 6, artist: "ì„ì˜ì›…", title: "ìˆœê°„ì„ ì˜ì›ì²˜ëŸ¼", url: "https://www.youtube.com/watch?v=sFK89gemgKM" },
      { rank: 7, artist: "IVE", title: "Off the Record", url: "https://www.youtube.com/watch?v=_ApV7Lm87cg" },
      { rank: 8, artist: "SEVENTEEN", title: "MAESTRO", url: "https://www.youtube.com/watch?v=ThI0pBAbFnk" },
      { rank: 9, artist: "NCT 127", title: "Fact Check (ë¶ˆê°€ì‚¬ì˜)", url: "https://www.youtube.com/watch?v=vGuJuW0bDWA" },
      { rank: 10, artist: "(ì—¬ì)ì•„ì´ë“¤", title: "Fate (ë‚˜ëŠ” ì•„í”ˆ ê±´ ë”± ì§ˆìƒ‰ì´ë‹ˆê¹Œ)", url: "https://www.youtube.com/watch?v=ATK7gAaZTOM" }
    ];

    let playlist = [];
    let current = 0;
    let loop = false;
    let isMuted = true; // ëª¨ë°”ì¼ ìë™ì¬ìƒì„ ìœ„í•´ ê¸°ë³¸ ìŒì†Œê±°
    let player; // YT.Player

    const $badge = document.getElementById('badge');
    const $now = document.getElementById('now');
    const $list = document.getElementById('list');
    const $play = document.getElementById('playBtn');
    const $prev = document.getElementById('prevBtn');
    const $next = document.getElementById('nextBtn');
    const $mute = document.getElementById('muteBtn');
    const $loop = document.getElementById('loopBtn');
    const $hint = document.getElementById('hint');

    // ìœ íŠœë¸Œ ì˜ìƒ ID ì¶”ì¶œ
    function vid(url){
      try{ const u = new URL(url); if(u.hostname.includes('youtu.be')) return u.pathname.slice(1); return u.searchParams.get('v'); }catch(e){ return null; }
    }

    // í”Œë ˆì´ì–´ ì´ˆê¸°í™” (videoIdê°€ ë°”ë€” ë•Œë§ˆë‹¤ í˜¸ì¶œ)
    function mount(videoId){
      if(!window.YT || !window.YT.Player) return;
      if(player){ try{ player.destroy(); }catch(e){} player = null; }
      player = new YT.Player('player',{
        height:'220', width:'100%', videoId,
        playerVars:{ autoplay:1, controls:1, modestbranding:1, rel:0, iv_load_policy:3, playsinline:1, mute:isMuted?1:0 },
        events:{
          onReady:e=>{ if(isMuted) e.target.mute(); e.target.playVideo(); $play.textContent='â¸'; },
          onStateChange:e=>{ if(e.data===0) next(); }, // ì¢…ë£Œì‹œ ë‹¤ìŒ ê³¡
          onError:()=>{ $hint.textContent='YouTube ì¬ìƒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.'; }
        }
      });
      updateNow();
      renderList();
    }

    function updateNow(){
      const item = playlist[current];
      if(!item) return;
      $badge.textContent = item.rank ?? '-';
      $now.textContent = `${item.artist} â€” ${item.title}`;
    }

    function renderList(){
      $list.innerHTML = '';
      playlist.forEach((item, idx)=>{
        const row = document.createElement('button');
        row.className = 'row' + (idx===current ? ' active' : '');
        row.innerHTML = `
          <div class="rank">${item.rank}</div>
          <div class="meta">
            <div class="artist">${item.artist}</div>
            <div class="title">${item.title}</div>
          </div>
          <div style="font-size:12px;color:${idx===current?'#be185d':'#94a3b8'}">${idx===current?'â— LIVE':'ì¬ìƒ'}</div>
        `;
        row.addEventListener('click',()=> select(idx));
        $list.appendChild(row);
      });
    }

    function prev(){ current = (current>0) ? current-1 : (loop ? playlist.length-1 : 0); select(current,true); }
    function next(){ current = (current < playlist.length-1) ? current+1 : (loop ? 0 : playlist.length-1); select(current,true); }

    function select(idx, autoplay){
      current = idx;
      const id = vid(playlist[current].url);
      if(id){ mount(id); if(!autoplay && player){ player.pauseVideo?.(); $play.textContent='â–¶ï¸'; } }
    }

    // ì»¨íŠ¸ë¡¤ ë°”ì¸ë”©
    $prev.addEventListener('click', prev);
    $next.addEventListener('click', next);

    $play.addEventListener('click', ()=>{
      if(!player) return;
      const state = player.getPlayerState?.();
      if(state===1){ player.pauseVideo(); $play.textContent='â–¶ï¸'; }
      else { player.playVideo(); $play.textContent='â¸'; }
    });

    $mute.addEventListener('click', ()=>{
      if(!player) return;
      if(isMuted){ player.unMute(); isMuted=false; $mute.textContent='ğŸ”Š'; }
      else { player.mute(); isMuted=true; $mute.textContent='ğŸ”‡'; }
    });

    $loop.addEventListener('click', ()=>{
      loop = !loop; $loop.style.background = loop ? 'var(--pink)' : '#fff';
      $loop.style.color = loop ? '#fff' : 'inherit';
      $loop.style.borderColor = loop ? 'var(--pink)' : 'var(--line)';
    });

    // JSON ë¡œë“œ (+ ì‹¤íŒ¨ì‹œ fallback)
    async function load(){
      try{
        const res = await fetch('videos.json', {cache:'no-store'});
        if(!res.ok) throw new Error('missing');
        playlist = await res.json();
        $hint.textContent = '';
      }catch(e){
        playlist = FALLBACK;
        $hint.textContent = 'âš ï¸ /videos.json ì„ ì°¾ì§€ ëª»í•´ ê¸°ë³¸ ë¦¬ìŠ¤íŠ¸ë¡œ ì¬ìƒí•©ë‹ˆë‹¤.';
      }
      select(0,true);
    }

    // YouTube Iframe API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
    function loadYT(){
      return new Promise(resolve=>{
        if(window.YT && window.YT.Player) return resolve();
        const s = document.createElement('script'); s.src='https://www.youtube.com/iframe_api';
        window.onYouTubeIframeAPIReady = ()=> resolve();
        document.body.appendChild(s);
      });
    }

    (async function init(){
      await loadYT();
      await load();
    })();
  </script>
</body>
</html>
